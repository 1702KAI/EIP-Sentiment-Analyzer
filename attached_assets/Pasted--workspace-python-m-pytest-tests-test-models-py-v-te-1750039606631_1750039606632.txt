~/workspace$ python -m pytest tests/test_models.py -v
=========================================== test session starts ===========================================
platform linux -- Python 3.11.10, pytest-8.4.0, pluggy-1.6.0 -- /home/runner/workspace/.pythonlibs/bin/python
cachedir: .pytest_cache
rootdir: /home/runner/workspace
configfile: pytest.ini
plugins: anyio-4.9.0, Flask-Dance-7.1.0, cov-6.2.1, flask-1.3.0
collected 13 items                                                                                        

tests/test_models.py::TestUserModel::test_user_creation PASSED                                      [  7%]
tests/test_models.py::TestUserModel::test_admin_user_creation PASSED                                [ 15%]
tests/test_models.py::TestUserModel::test_user_string_representation PASSED                         [ 23%]
tests/test_models.py::TestAnalysisJobModel::test_job_creation PASSED                                [ 30%]
tests/test_models.py::TestAnalysisJobModel::test_job_status_updates PASSED                          [ 38%]
tests/test_models.py::TestAnalysisJobModel::test_job_completion PASSED                              [ 46%]
tests/test_models.py::TestEIPSentimentModel::test_eip_sentiment_creation PASSED                     [ 53%]
tests/test_models.py::TestEIPSentimentModel::test_eip_sentiment_filtering FAILED                    [ 61%]
tests/test_models.py::TestEIPSentimentModel::test_negative_sentiment_filtering FAILED               [ 69%]
tests/test_models.py::TestOutputFileModel::test_output_file_creation PASSED                         [ 76%]
tests/test_models.py::TestOutputFileModel::test_job_output_relationship PASSED                      [ 84%]
tests/test_models.py::TestModelValidation::test_unique_user_email PASSED                            [ 92%]
tests/test_models.py::TestModelValidation::test_eip_job_index FAILED                                [100%]

================================================ FAILURES =================================================
___________________________ TestEIPSentimentModel.test_eip_sentiment_filtering ____________________________

self = <test_models.TestEIPSentimentModel object at 0x7f45d79a8790>, test_app = <Flask 'app'>
eip_sentiment_data = [<EIPSentiment 1>, <EIPSentiment 2>, <EIPSentiment 3>]
analysis_job = <AnalysisJob test-job-789>

    def test_eip_sentiment_filtering(self, test_app, eip_sentiment_data, analysis_job):
        """Test filtering EIP sentiment data"""
        with test_app.app_context():
            db.session.add(analysis_job)
            job_id = analysis_job.id
    
            # Filter by status
            final_eips = EIPSentiment.query.filter_by(
                job_id=job_id, status='Final'
            ).all()
    
>           assert len(final_eips) == 3  # All test data is Final status
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           assert 0 == 3
E            +  where 0 = len([])

tests/test_models.py:163: AssertionError
_________________________ TestEIPSentimentModel.test_negative_sentiment_filtering _________________________

self = <test_models.TestEIPSentimentModel object at 0x7f45d799f510>, test_app = <Flask 'app'>
eip_sentiment_data = [<EIPSentiment 1>, <EIPSentiment 2>, <EIPSentiment 3>]
analysis_job = <AnalysisJob test-job-789>

    def test_negative_sentiment_filtering(self, test_app, eip_sentiment_data, analysis_job):
        """Test filtering EIPs with negative sentiment"""
        with test_app.app_context():
            db.session.add(analysis_job)
            job_id = analysis_job.id
    
            negative_eips = EIPSentiment.query.filter(
                EIPSentiment.job_id == job_id,
                EIPSentiment.unified_compound < 0
            ).all()
    
>           assert len(negative_eips) == 1  # Only EIP-721 has negative sentiment
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
E           assert 0 == 1
E            +  where 0 = len([])

tests/test_models.py:183: AssertionError
_________________________________ TestModelValidation.test_eip_job_index __________________________________

self = <test_models.TestModelValidation object at 0x7f45d799d010>, test_app = <Flask 'app'>
analysis_job = <AnalysisJob test-job-789>

    def test_eip_job_index(self, test_app, analysis_job):
        """Test EIP-job compound index functionality"""
        with test_app.app_context():
            # Create two sentiment records for same EIP in same job
            sentiment1 = EIPSentiment()
>           sentiment1.job_id = analysis_job.id
                                ^^^^^^^^^^^^^^^

tests/test_models.py:272: 
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:566: in __get__
    return self.impl.get(state, dict_)  # type: ignore[no-any-return]
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:1086: in get
    value = self._fire_loader_callables(state, key, passive)
            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/attributes.py:1116: in _fire_loader_callables
    return state._load_expired(state, passive)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/state.py:803: in _load_expired
    self.manager.expired_attribute_loader(self, toload, passive)
_ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _ _

mapper = <Mapper at 0x7f45d7c95290; AnalysisJob>
state = <sqlalchemy.orm.state.InstanceState object at 0x7f45d7d85790>
attribute_names = {'completed_at', 'created_at', 'error_message', 'filename', 'id', 'original_filename', ...}
passive = symbol('PASSIVE_OFF')

    def load_scalar_attributes(mapper, state, attribute_names, passive):
        """initiate a column-based attribute refresh operation."""
    
        # assert mapper is _state_mapper(state)
        session = state.session
        if not session:
>           raise orm_exc.DetachedInstanceError(
                "Instance %s is not bound to a Session; "
                "attribute refresh operation cannot proceed" % (state_str(state))
            )
E           sqlalchemy.orm.exc.DetachedInstanceError: Instance <AnalysisJob at 0x7f45d7545e50> is not bound to a Session; attribute refresh operation cannot proceed (Background on this error at: https://sqlalche.me/e/20/bhk3)

.pythonlibs/lib/python3.11/site-packages/sqlalchemy/orm/loading.py:1603: DetachedInstanceError
============================================ warnings summary =============================================
tests/test_models.py::TestUserModel::test_user_creation
  /home/runner/workspace/tests/test_models.py:27: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    retrieved_user = User.query.get('test-123')

tests/test_models.py::TestUserModel::test_admin_user_creation
  /home/runner/workspace/tests/test_models.py:43: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    retrieved_admin = User.query.get('admin-456')

tests/test_models.py::TestAnalysisJobModel::test_job_creation
  /home/runner/workspace/tests/test_models.py:69: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    retrieved_job = AnalysisJob.query.get('job-789')

tests/test_models.py::TestAnalysisJobModel::test_job_status_updates
  /home/runner/workspace/tests/test_models.py:92: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    updated_job = AnalysisJob.query.get('job-update-test')

tests/test_models.py::TestAnalysisJobModel::test_job_completion
  /home/runner/workspace/tests/test_models.py:114: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    completed_job = AnalysisJob.query.get('job-complete-test')

tests/test_models.py::TestOutputFileModel::test_job_output_relationship
  /home/runner/workspace/tests/test_models.py:233: LegacyAPIWarning: The Query.get() method is considered legacy as of the 1.x series of SQLAlchemy and becomes a legacy construct in 2.0. The method is now available as Session.get() (deprecated since: 2.0) (Background on SQLAlchemy 2.0 at: https://sqlalche.me/e/b8d9)
    job = AnalysisJob.query.get(job_id)

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
========================================= short test summary info =========================================
FAILED tests/test_models.py::TestEIPSentimentModel::test_eip_sentiment_filtering - assert 0 == 3
FAILED tests/test_models.py::TestEIPSentimentModel::test_negative_sentiment_filtering - assert 0 == 1
FAILED tests/test_models.py::TestModelValidation::test_eip_job_index - sqlalchemy.orm.exc.DetachedInstanceError: Instance <AnalysisJob at 0x7f45d7545e50> is not bound to a S...
================================ 3 failed, 10 passed, 6 warnings in 11.80s ================================
~/workspace$  